{% extends "admin/base.html" %}

{% block title %}Guild Roles - Smarter.Dev Admin{% endblock %}

{% block content %}
<div class="roles-page">
    <div class="section-header">
        <h3 class="section-title">Discord Roles for {{ guild.name }}</h3>
        <div class="header-actions">
            {% if guild.moderator_role_id %}
            <form method="POST" action="/admin/discord/guilds/{{ guild.id }}/edit" style="display: inline-block;">
                <input type="hidden" name="name" value="{{ guild.name }}">
                <input type="hidden" name="moderator_role_id" value="">
                <button type="submit" class="btn btn-danger">Clear Moderator Role</button>
            </form>
            {% endif %}
            <a href="/admin/discord/guilds" class="btn btn-secondary">Back to Guilds</a>
        </div>
    </div>

    <div class="data-section">
        {% if error_message %}
        <div class="error-message">
            <p><strong>Error:</strong> {{ error_message }}</p>
            <p>Please make sure:</p>
            <ul>
                <li>The SMARTER_DEV_BOT_TOKEN environment variable is set correctly</li>
                <li>The bot has been added to this Discord server</li>
                <li>The bot has permission to view roles in this server</li>
            </ul>

            <div class="debug-info">
                <p><strong>Debug Information:</strong></p>
                <ul>
                    <li>Guild ID: {{ guild.id }}</li>
                    <li>Guild Name: {{ guild.name }}</li>
                </ul>
            </div>
        </div>
        {% endif %}

        <div class="table-container">
            <table class="data-table" id="roles-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for role in roles %}
                    <tr>
                        <td>
                            <span class="role-name" style="color: {{ role.color if role.color != '#000000' else 'inherit' }}">
                                {% if role.icon_url %}
                                <img src="{{ role.icon_url }}" alt="{{ role.name }} icon" class="role-icon">
                                {% else %}
                                <div class="role-color" style="background-color: {{ role.color }}"></div>
                                {% endif %}
                                {{ role.name }}
                            </span>
                        </td>
                        <td>
                            <form method="POST" action="/admin/discord/guilds/{{ guild.id }}/edit">
                                <input type="hidden" name="name" value="{{ guild.name }}">
                                <input type="hidden" name="moderator_role_id" value="{{ role.id }}">
                                <button type="submit" class="btn btn-sm btn-primary">{% if guild.moderator_role_id|string == role.id %}âœ“ Current Moderator Role{% else %}Set as Moderator Role{% endif %}</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                    {% if not roles %}
                    <tr>
                        <td colspan="2" class="empty-table">No roles found for this guild.</td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<style>
    .roles-page {
        display: flex;
        flex-direction: column;
        gap: 2rem;
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }

    .header-actions {
        display: flex;
        gap: 0.5rem;
    }

    .error-message {
        background-color: rgba(255, 0, 0, 0.1);
        border-left: 4px solid #ff3333;
        padding: 1rem;
        margin-bottom: 1.5rem;
        border-radius: 4px;
    }

    .error-message p {
        margin: 0.5rem 0;
    }

    .error-message ul {
        margin: 0.5rem 0;
        padding-left: 1.5rem;
    }

    .debug-info {
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px dashed rgba(255, 255, 255, 0.2);
        font-family: monospace;
        font-size: 0.9rem;
    }

    .data-section {
        background-color: var(--card-bg);
        border-radius: 8px;
        padding: 1.5rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .role-name {
        display: flex;
        align-items: center;
        font-weight: 500;
    }

    .role-color {
        display: inline-block;
        width: 16px;
        height: 16px;
        border-radius: 4px;
        margin-right: 8px;
        vertical-align: middle;
        border: 1px solid rgba(255, 255, 255, 0.2);
        flex-shrink: 0;
    }

    .role-icon {
        width: 20px;
        height: 20px;
        border-radius: 4px;
        margin-right: 8px;
        vertical-align: middle;
        flex-shrink: 0;
        object-fit: contain;
    }
</style>
{% endblock %}
